# goakit plugin example

This example shows how to use the [Goa](https://goa.design) [goakit](https://github.com/goadesign/plugins/tree/master/goakit)
plugin to create a [Go kit](http://gokit.io) microservice.

## Installation

Goa v3 and this example require the use of Go modules. This means your system must have Go 1.11 or greater.

To install Goa v3 Go modules must be enabled:

```bash
export GO111MODULE=on
```

Next simply `go get` Goa (note: this is a two step process because of [this](https://github.com/golang/go/issues/27215)).

```bash
go get goa.design/goa/v3
go get goa.design/goa/v3/...
```

To run the example, first clone the plugins repo:

```bash
git clone https://github.com/goadesign/plugins
```

Then compile and run the server:

```bash
cd plugins/goakit/examples/calc/cmd/calc
go build
./calc --http-port 8000
```

and the client (in a different console):

```bash
cd ../calc-cli
go build
./calc-cli --url http://localhost:8000 calc add -a 1 -b 2 
```

## Navigating the code

The generated code follows the clean architecture pattern where the transport layer, endpoint (sometimes called adapter) layer
and business logic are all encapsulated in different packages and composed together to form the final service.

The transport and endpoint layers are completely generated by Goa for both the server and client. This includes a Go kit HTTP
[encoder and decoder](https://github.com/goadesign/plugins/blob/master/goakit/examples/calc/gen/http/calc/kitserver/encode_decode.go)
and [code](https://github.com/goadesign/plugins/blob/master/goakit/examples/calc/gen/http/calc/server/server.go#L45)
to compose the transport with the Go kit endpoint.

The [main](https://github.com/goadesign/plugins/blob/master/goakit/examples/calc/cmd/calc/main.go)
of the server configures all the modules and composes them into the final HTTP server. This file was originally generated by
Goa as well using the goa tool `example` command.

## Enabling the goakit plugin in your projects

Enabling the plugin is done by importing the plugin package in the design. Here is the relevant extract from the file
[design.go](https://github.com/goadesign/plugins/blob/master/goakit/examples/calc/design/design.go#L5) in this example:

```go
import (
	. "goa.design/goa/v3/dsl"
	_ "goa.design/plugins/goakit"  // THIS LINE ENABLES THE GOAKIT PLUGIN
)
```

Code generation is done as usual using the `goa` tool.
Make sure Go modules are enabled (only needed if working under GOPATH):

```bash
export GO111MODULE=on
```

For this example run:

```bash
goa gen goa.design/plugins/goakit/examples/calc/design
```

